---
title: "ECON 470 Homework 3-2 Answers"
author: "Ilse Novis"
date: "3/19/2025"
format: pdf
execute:
  echo: true
---
 \newpage
 \begin{center}
# ECON 470 Homework 3-2 Answers 
# **Summary Statistics**  
\end{center}
\newpage

```{python}
import pandas as pd
import numpy as np
import statsmodels.api as sm
import matplotlib.pyplot as pltimport 
import statsmodels.formula.api as smf
```

```{python}
data_path = "/Users/ilsenovis/Documents/GitHub/ECON470HW3/data/output/TaxBurden_Data.csv"
df = pd.read_csv(data_path)
```

\begin{center}
## **Question 1:** Proportion of States with Tax Change (1970-1985)
\end{center}
```{python}
df_q1 = df.copy()
df_q1 = df_q1[(df_q1['Year'] >= 1970) & (df_q1['Year'] <=1985)]
df_q1 = df_q1.sort_values(by=['state', 'Year'])
df_q1['tax_change'] = df_q1.groupby('state')['tax_state'].diff().ne(0)
tax_change_proportion = df_q1.groupby('Year')['tax_change'].mean()

plt.figure(figsize=(10, 6))
tax_change_proportion.plot(kind='bar', color='skyblue', edgecolor='black')
plt.xlabel('Year')
plt.ylabel('Proportion of States with Tax Change')
plt.title('Proportion of States with Cigarette Tax Change (1970-1985)')
plt.xticks(rotation=45)
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 2:** Average Tax and Price Trends (1970-2018)
\end{center}
```{python}
df_q2 = df.copy()
df_q2 = df_q2[(df_q2['Year'] >= 1970) & (df_q2['Year'] <=2018)]

avg_tax_per_year = df_q2.groupby('Year')['tax_2012'].mean()
avg_price_per_year = df_q2.groupby('Year')['price_cpi'].mean()

plt.figure(figsize=(10, 6))
plt.plot(avg_tax_per_year, label='Average Tax per Pack (2012 Dollars)', color='green', linewidth=2)
plt.plot(avg_price_per_year, label='Average Price per Pack (2012 Dollars)', color='purple', linewidth=2)
plt.xlabel('Year')
plt.ylabel('Dollars per Pack')
plt.title('Average Cigarette Tax & Price per Pack (1970-2018, Adjusted to 2012 Dollars)')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 3:** Top 5 States with Highest Price Increase (1970-2018)
\end{center}
```{python}
df_q3 = df.copy()
df_q3 = df_q3[(df_q3['Year'] >= 1970) & (df_q3['Year'] <= 2018)]

price_change = df_q3.groupby('state')['price_cpi'].agg(['first', 'last'])
price_change['price_increase'] = price_change['last'] - price_change['first']
top_5_states = price_change.nlargest(5, 'price_increase').index.tolist()
df_q3 = df_q3[df_q3['state'].isin(top_5_states)]

avg_sales_per_year = df_q3.groupby(['Year', 'state'])['sales_per_capita'].mean().unstack()

plt.figure(figsize=(10, 6))
for state in top_5_states:
    plt.plot(avg_sales_per_year.index, avg_sales_per_year[state], label=state)
plt.xlabel('Year')
plt.ylabel('Packs Sold Per Capita')
plt.title('Average Cigarette Packs Sold Per Capita (Top 5 States with Highest Price Increase, 1970-2018)')
plt.legend(title='State')
plt.grid(True, linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 4:** Bottom 5 States with Lowest Price Increase (1970-2018)
\end{center}
```{python}
df_q4 = df.copy()
df_q4 = df_q4[(df_q4['Year'] >= 1970) & (df_q4['Year'] <= 2018)]

price_change = df_q4.groupby('state')['price_cpi'].agg(['first', 'last'])
price_change['price_increase'] = price_change['last'] - price_change['first']
bottom_5_states = price_change.nsmallest(5, 'price_increase').index.tolist()
df_q4 = df_q4[df_q4['state'].isin(bottom_5_states)]

avg_sales_per_year = df_q4.groupby(['Year', 'state'])['sales_per_capita'].mean().unstack()

plt.figure(figsize=(10, 6))
for state in bottom_5_states:
    plt.plot(avg_sales_per_year.index, avg_sales_per_year[state], label=state)
plt.xlabel('Year')
plt.ylabel('Packs Sold Per Capita')
plt.title('Average Cigarette Packs Sold Per Capita (Bottom 5 States with Lowest Price Increase, 1970-2018)')
plt.legend(title='State')
plt.grid(True, linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 5:** Compare the trends in sales from the 5 states with the highest price increases to those with the lowest price increases.
\end{center}
```{python}
# Create seperate copy for this question
df_q5 = df.copy()

# Filter for years 1970-2018
df_q5 = df_q5[(df_q5['Year'] >= 1970) & (df_q5['Year'] <= 2018)]

# Compute the first and last cigarette price for each state
price_change = df_q5.groupby("state")["price_cpi"].agg(["first", "last"])
price_change["price_increase"] = price_change["last"] - price_change["first"]

# Identify the 5 states with the highest price increase
top_5_states = price_change.nlargest(5, "price_increase").index.tolist()
#print("Top 5 states with highest price increase:", top_5_states)

# Identify the 5 states with the lowest price increase
bottom_5_states = price_change.nsmallest(5, "price_increase").index.tolist()
#print("Bottom 5 states with lowest price increase:", bottom_5_states)

# Filter the dataset for these states only
df_q5_top = df_q5[df_q5["state"].isin(top_5_states)]
df_q5_bottom = df_q5[df_q5["state"].isin(bottom_5_states)]

# Compute the average packs sold per capita for each group
avg_sales_top = df_q5_top.groupby('Year')['sales_per_capita'].mean()
avg_sales_bottom = df_q5_bottom.groupby('Year')['sales_per_capita'].mean()

# Plot the trends for both groups
plt.figure(figsize=(10, 6))
plt.plot(avg_sales_top.index, avg_sales_top, label='Top 5 States (Highest Price Increase)', 
         color='orange', linewidth=2)
plt.plot(avg_sales_bottom.index, avg_sales_bottom, label='Top 5 States (Lowest Price Increase)', 
         color='pink', linestyle='--', linewidth=2)  # Dashed line for bottom 5 states

# Format Graph
plt.xlabel('Year')
plt.ylabel('Packs Sold Per Capita')
plt.title('Comparison of Cigarette Sales: Highest vs Lowest Price Increases (1970-2018)')
plt.legend(title="Group")
plt.grid(True, linestyle='--', alpha=0.7)

# Show plot
plt.show()
```

\begin{center}
\newpage
# **Estimate ATEs:**
\end{center}
\newpage

\begin{center}
## **Question 9:** Repeat questions 1-3 focusing on the period from 1991 to 2015.
\end{center}
### **Question 9.1** Bar graph showing the proportion of states with a change in their cigarette tax

```{python}
# Create seperate copy for this question
df_q9 = df.copy()

# Filter for years 1991-2015
df_q9 = df_q9[(df_q9['Year'] >= 1991) & (df_q9['Year'] <= 2015)]

# ---- Question 1: Proportion of States with a Tax Change (1991-2015) ---- #
df_q9_q1 = df_q9.copy()
df_q9_q1 = df_q9_q1.sort_values(by=['state', 'Year'])
df_q9_q1['tax_change'] = df_q9_q1.groupby('state')['tax_state'].diff().ne(0)
tax_change_proportion_q9 = df_q9_q1.groupby('Year')['tax_change'].mean()

# Plot bar graph
plt.figure(figsize=(10, 6))
tax_change_proportion_q9.plot(kind='bar', color='skyblue', edgecolor='black')
plt.xlabel('Year')
plt.ylabel('Proportion of States with Tax Change')
plt.title('Proportion of States with Cigarette Tax Change (1991-2015)')
plt.xticks(rotation=45)
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 9:** Repeat questions 1-3 focusing on the period from 1991 to 2015.
\end{center}
### **Question 9.2** Average tax (in 2012 dollars) on cigarettes and the average price of a pack of cigarettes from 1991 to 2015
```{python}
# ---- Question 2: Average Tax & Price Per Pack (1991-2015) ---- #
df_q9_q2 = df_q9.copy()

# Compute yearly averages for tax and price (already adjusted for 2012 dollars in data-code)
avg_tax_per_year_q9 = df_q9_q2.groupby('Year')['tax_2012'].mean()
avg_price_per_year_q9 = df_q9_q2.groupby('Year')['price_cpi'].mean()

# Plot both on the same graph
plt.figure(figsize=(10, 6))
plt.plot(avg_tax_per_year_q9, label='Average Tax per Pack (2012 Dollars)', color='green', linewidth=2)
plt.plot(avg_price_per_year_q9, label='Average Price per Pack (2012 Dollars)', color='purple', linewidth=2)

# Graph formatting
plt.xlabel('Year')
plt.ylabel('Dollars per Pack')
plt.title('Average Cigarette Tax & Price per Pack (1991-2015, Adjusted to 2012 Dollars)')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 9:** Repeat questions 1-3 focusing on the period from 1991 to 2015.
\end{center}
### **Question 9.3:** Identify the 5 states with the highest increases in cigarette prices (in dollars) over the time period. Plot the average number of packs sold per capita for those states from 1991 to 2015
```{python}
# ---- Question 3: Top 5 States with Highest Price Increase (1991-2015) ---- #
df_q9_q3 = df_q9.copy()

# Compute the first and last cigarette price for each state
price_change_q9 = df_q9_q3.groupby("state")["price_cpi"].agg(["first", "last"])
price_change_q9["price_increase"] = price_change_q9["last"] - price_change_q9["first"]

# Identify the 5 states with the highest price increase
top_5_states_q9 = price_change_q9.nlargest(5, "price_increase").index.tolist()
#print("Top 5 states with highest price increase (1991-2015):", top_5_states_q9)

# Filter the dataset for these states only
df_q9_q3 = df_q9_q3[df_q9_q3["state"].isin(top_5_states_q9)]

# Compute the average packs sold per capita for these states each year
avg_sales_per_year_q9 = df_q9_q3.groupby(["Year", "state"])["sales_per_capita"].mean().unstack()

# Plot the trend for each of the top 5 states
plt.figure(figsize=(10, 6))
for state in top_5_states_q9:
    plt.plot(avg_sales_per_year_q9.index, avg_sales_per_year_q9[state], label=state)

# Graph formatting
plt.xlabel('Year')
plt.ylabel('Packs Sold Per Capita')
plt.title('Average Cigarette Packs Sold Per Capita (Top 5 States with Highest Price Increase, 1991-2015)')
plt.legend(title="State")
plt.grid(True, linestyle="--", alpha=0.7)
plt.show()
```
\newpage

\begin{center}
## **Question 10:** Compare Elasticity estimates from 1970-1990 versus those from 1991-2015 (Q6-9). Are they different? If so, why?
\end{center}
```{python}

```

